<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Approximate Invariance with Penalized Estimation â€¢ plavaan</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Approximate Invariance with Penalized Estimation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plavaan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/approximate-invariance.html">Approximate Invariance with Penalized Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/penalized-cat.html">Penalized Estimation with Ordinal Data and Multiple Groups</a></li>
    <li><a class="dropdown-item" href="../articles/penalized-fa.html">Penalized Estimation of Cross-Loadings and Unique Covariances</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Approximate Invariance with Penalized Estimation</h1>
            
      

      <div class="d-none name"><code>approximate-invariance.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marklhc.github.io/plavaan/">plavaan</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is lavaan 0.6-20</span></span>
<span><span class="co">#&gt; lavaan is FREE software! Please report any bugs.</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the PoliticalDemocracy data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"PoliticalDemocracy"</span>, package <span class="op">=</span> <span class="st">"lavaan"</span><span class="op">)</span></span>
<span><span class="co"># Configural invariance (pretend y7 is not available in dem65),</span></span>
<span><span class="co"># and freely estimated latent means and variances</span></span>
<span><span class="va">config_mod</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  dem60 =~ y1 + y2 + y3 + y4</span></span>
<span><span class="st">  dem65 =~ y5 + y6 +      y8</span></span>
<span><span class="st">  dem60 ~~ dem65</span></span>
<span><span class="st">  dem60 ~~ 1 * dem60</span></span>
<span><span class="st">  dem65 ~~ NA * dem65</span></span>
<span><span class="st">  dem60 ~ 0</span></span>
<span><span class="st">  dem65 ~ NA * 1</span></span>
<span><span class="st">  y1 ~~ y5</span></span>
<span><span class="st">  y2 ~~ y6</span></span>
<span><span class="st">  y4 ~~ y8</span></span>
<span><span class="st">"</span></span>
<span><span class="va">fit_dry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/cfa.html" class="external-link">cfa</a></span><span class="op">(</span><span class="va">config_mod</span>, data <span class="op">=</span> <span class="va">PoliticalDemocracy</span>, auto.fix.first <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               do.fit <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Penalized estimation can be used to achieve approximate invariance by
penalizing the differences in intercepts and loadings across groups.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/parTable.html" class="external-link">parTable</a></span><span class="op">(</span><span class="va">fit_dry</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id   lhs op   rhs user block group free ustart exo label plabel start   est</span></span>
<span><span class="co">#&gt; 1   1 dem60 =~    y1    1     1     1    1     NA   0         .p1. 2.224 2.224</span></span>
<span><span class="co">#&gt; 2   2 dem60 =~    y2    1     1     1    2     NA   0         .p2. 2.882 2.882</span></span>
<span><span class="co">#&gt; 3   3 dem60 =~    y3    1     1     1    3     NA   0         .p3. 2.347 2.347</span></span>
<span><span class="co">#&gt; 4   4 dem60 =~    y4    1     1     1    4     NA   0         .p4. 2.877 2.877</span></span>
<span><span class="co">#&gt; 5   5 dem65 =~    y5    1     1     1    5     NA   0         .p5. 1.000 1.000</span></span>
<span><span class="co">#&gt; 6   6 dem65 =~    y6    1     1     1    6     NA   0         .p6. 1.545 1.545</span></span>
<span><span class="co">#&gt; 7   7 dem65 =~    y8    1     1     1    7     NA   0         .p7. 1.657 1.657</span></span>
<span><span class="co">#&gt; 8   8 dem60 ~~ dem65    1     1     1    8     NA   0         .p8. 0.000 0.000</span></span>
<span><span class="co">#&gt; 9   9 dem60 ~~ dem60    1     1     1    0      1   0         .p9. 1.000 1.000</span></span>
<span><span class="co">#&gt; 10 10 dem65 ~~ dem65    1     1     1    9     NA   0        .p10. 0.050 0.050</span></span>
<span><span class="co">#&gt; 11 11 dem60 ~1          1     1     1    0      0   0        .p11. 0.000 0.000</span></span>
<span><span class="co">#&gt; 12 12 dem65 ~1          1     1     1   10     NA   0        .p12. 0.000 0.000</span></span>
<span><span class="co">#&gt; 13 13    y1 ~~    y5    1     1     1   11     NA   0        .p13. 0.000 0.000</span></span>
<span><span class="co">#&gt; 14 14    y2 ~~    y6    1     1     1   12     NA   0        .p14. 0.000 0.000</span></span>
<span><span class="co">#&gt; 15 15    y4 ~~    y8    1     1     1   13     NA   0        .p15. 0.000 0.000</span></span>
<span><span class="co">#&gt; 16 16    y1 ~~    y1    0     1     1   14     NA   0        .p16. 3.393 3.393</span></span>
<span><span class="co">#&gt; 17 17    y2 ~~    y2    0     1     1   15     NA   0        .p17. 7.686 7.686</span></span>
<span><span class="co">#&gt; 18 18    y3 ~~    y3    0     1     1   16     NA   0        .p18. 5.310 5.310</span></span>
<span><span class="co">#&gt; 19 19    y4 ~~    y4    0     1     1   17     NA   0        .p19. 5.535 5.535</span></span>
<span><span class="co">#&gt; 20 20    y5 ~~    y5    0     1     1   18     NA   0        .p20. 3.367 3.367</span></span>
<span><span class="co">#&gt; 21 21    y6 ~~    y6    0     1     1   19     NA   0        .p21. 5.612 5.612</span></span>
<span><span class="co">#&gt; 22 22    y8 ~~    y8    0     1     1   20     NA   0        .p22. 5.197 5.197</span></span>
<span><span class="co">#&gt; 23 23    y1 ~1          0     1     1   21     NA   0        .p23. 5.465 5.465</span></span>
<span><span class="co">#&gt; 24 24    y2 ~1          0     1     1   22     NA   0        .p24. 4.256 4.256</span></span>
<span><span class="co">#&gt; 25 25    y3 ~1          0     1     1   23     NA   0        .p25. 6.563 6.563</span></span>
<span><span class="co">#&gt; 26 26    y4 ~1          0     1     1   24     NA   0        .p26. 4.453 4.453</span></span>
<span><span class="co">#&gt; 27 27    y5 ~1          0     1     1   25     NA   0        .p27. 5.136 5.136</span></span>
<span><span class="co">#&gt; 28 28    y6 ~1          0     1     1   26     NA   0        .p28. 2.978 2.978</span></span>
<span><span class="co">#&gt; 29 29    y8 ~1          0     1     1   27     NA   0        .p29. 4.043 4.043</span></span>
<span><span class="co"># Create matrix to indicate the same item loadings across groups/time in columns for</span></span>
<span><span class="co"># penalization on the pairwise differences</span></span>
<span><span class="va">ld_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span>, <span class="cn">NA</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">int_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">21</span><span class="op">:</span><span class="fl">24</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span><span class="op">:</span><span class="fl">26</span>, <span class="cn">NA</span>, <span class="fl">27</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit_pen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/penalized_est.html">penalized_est</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_dry</span>, w <span class="op">=</span> <span class="fl">.03</span>, pen_diff_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>loadings <span class="op">=</span> <span class="va">ld_mat</span>, intercepts <span class="op">=</span> <span class="va">int_mat</span><span class="op">)</span>,</span>
<span>  se <span class="op">=</span> <span class="st">"robust.huber.white"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_pen</span><span class="op">)</span></span>
<span><span class="co">#&gt; lavaan 0.6-20 ended normally after 90 iterations</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Estimator                                         ML</span></span>
<span><span class="co">#&gt;   Optimization method                           NLMINB</span></span>
<span><span class="co">#&gt;   Number of model parameters                        27</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Number of observations                            75</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter Estimates:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Standard errors                             Sandwich</span></span>
<span><span class="co">#&gt;   Information bread                           Observed</span></span>
<span><span class="co">#&gt;   Observed information based on                Hessian</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Latent Variables:</span></span>
<span><span class="co">#&gt;                    Estimate  Std.Err  z-value  P(&gt;|z|)</span></span>
<span><span class="co">#&gt;   dem60 =~                                            </span></span>
<span><span class="co">#&gt;     y1                2.099    0.213    9.871    0.000</span></span>
<span><span class="co">#&gt;     y2                2.971    0.285   10.416    0.000</span></span>
<span><span class="co">#&gt;     y3                2.260    0.323    6.991    0.000</span></span>
<span><span class="co">#&gt;     y4                2.970    0.219   13.564    0.000</span></span>
<span><span class="co">#&gt;   dem65 =~                                            </span></span>
<span><span class="co">#&gt;     y5                2.089    0.217    9.617    0.000</span></span>
<span><span class="co">#&gt;     y6                2.962    0.292   10.160    0.000</span></span>
<span><span class="co">#&gt;     y8                2.993    0.225   13.288    0.000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Covariances:</span></span>
<span><span class="co">#&gt;                    Estimate  Std.Err  z-value  P(&gt;|z|)</span></span>
<span><span class="co">#&gt;   dem60 ~~                                            </span></span>
<span><span class="co">#&gt;     dem65             0.871    0.056   15.616    0.000</span></span>
<span><span class="co">#&gt;  .y1 ~~                                               </span></span>
<span><span class="co">#&gt;    .y5                0.940    0.454    2.073    0.038</span></span>
<span><span class="co">#&gt;  .y2 ~~                                               </span></span>
<span><span class="co">#&gt;    .y6                1.748    0.899    1.944    0.052</span></span>
<span><span class="co">#&gt;  .y4 ~~                                               </span></span>
<span><span class="co">#&gt;    .y8                0.248    0.504    0.491    0.623</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Intercepts:</span></span>
<span><span class="co">#&gt;                    Estimate  Std.Err  z-value  P(&gt;|z|)</span></span>
<span><span class="co">#&gt;     dem60             0.000                           </span></span>
<span><span class="co">#&gt;     dem65            -0.146    0.073   -2.006    0.045</span></span>
<span><span class="co">#&gt;    .y1                5.455    0.290   18.783    0.000</span></span>
<span><span class="co">#&gt;    .y2                4.251    0.455    9.351    0.000</span></span>
<span><span class="co">#&gt;    .y3                6.563    0.376   17.449    0.000</span></span>
<span><span class="co">#&gt;    .y4                4.465    0.376   11.866    0.000</span></span>
<span><span class="co">#&gt;    .y5                5.454    0.290   18.803    0.000</span></span>
<span><span class="co">#&gt;    .y6                3.411    0.450    7.580    0.000</span></span>
<span><span class="co">#&gt;    .y8                4.466    0.376   11.867    0.000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variances:</span></span>
<span><span class="co">#&gt;                    Estimate  Std.Err  z-value  P(&gt;|z|)</span></span>
<span><span class="co">#&gt;     dem60             1.000                           </span></span>
<span><span class="co">#&gt;     dem65             0.867    0.094    9.262    0.000</span></span>
<span><span class="co">#&gt;    .y1                2.202    0.520    4.236    0.000</span></span>
<span><span class="co">#&gt;    .y2                6.470    1.338    4.834    0.000</span></span>
<span><span class="co">#&gt;    .y3                5.512    1.087    5.069    0.000</span></span>
<span><span class="co">#&gt;    .y4                2.465    0.627    3.930    0.000</span></span>
<span><span class="co">#&gt;    .y5                3.007    0.616    4.879    0.000</span></span>
<span><span class="co">#&gt;    .y6                3.745    0.801    4.673    0.000</span></span>
<span><span class="co">#&gt;    .y8                2.417    0.711    3.401    0.001</span></span></code></pre></div>
<p>The penalized estimation finds a solution where the loadings and
intercepts difference are minimized, depending on the penalty weight
<code>w</code>.</p>
<div class="section level2">
<h2 id="compared-to-results-from-mplus-version-9-0">Compared to Results from Mplus (version 9.0)<a class="anchor" aria-label="anchor" href="#compared-to-results-from-mplus-version-9-0"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># export to Mplus</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">PoliticalDemocracy</span>,</span>
<span>            file <span class="op">=</span> <span class="st">"inst/mplus/PoliticalDemocracy.dat"</span>,</span>
<span>            row.names <span class="op">=</span> <span class="cn">FALSE</span>, col.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Mplus syntax</span></span>
<span><span class="va">mplus_syntax</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">TITLE:  Penalized invariance CFA model;</span></span>
<span><span class="st">DATA:   FILE = PoliticalDemocracy.dat;</span></span>
<span><span class="st">VARIABLE:</span></span>
<span><span class="st">        NAMES = y1-y8;</span></span>
<span><span class="st">        USEVARIABLES = y1-y6 y8;</span></span>
<span><span class="st">MODEL:  dem60 BY y1-y4* (l1_1-l1_4);</span></span>
<span><span class="st">        dem65 BY y5-y6* (l2_1-l2_2)</span></span>
<span><span class="st">                 y8* (l2_4);</span></span>
<span><span class="st">        dem60@1;</span></span>
<span><span class="st">        dem65*1;</span></span>
<span><span class="st">        [dem60@0];</span></span>
<span><span class="st">        [dem65*0];</span></span>
<span><span class="st">        [y1-y4] (i1_1-i1_4);</span></span>
<span><span class="st">        [y5-y6] (i2_1-i2_2);</span></span>
<span><span class="st">        [y8] (i2_4);</span></span>
<span><span class="st">        y1 WITH y5;</span></span>
<span><span class="st">        y2 WITH y6;</span></span>
<span><span class="st">        y4 WITH y8;</span></span>
<span><span class="st">MODEL PRIOR:</span></span>
<span><span class="st">        DO(#,1,2) DIFF(l1_# , l2_#) ~ ALF(0,1);</span></span>
<span><span class="st">        DO(#,1,2) DIFF(i1_# , i2_#) ~ ALF(0,1);</span></span>
<span><span class="st">        DIFF(l1_4 , l2_4) ~ ALF(0,1);</span></span>
<span><span class="st">        DIFF(i1_4 , i2_4) ~ ALF(0,1);</span></span>
<span><span class="st">"</span></span>
<span><span class="co"># Save Mplus syntax</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">mplus_syntax</span>, con <span class="op">=</span> <span class="st">"inst/mplus/penalized_invariance.inp"</span><span class="op">)</span></span>
<span><span class="co"># Run Mplus</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"cd inst/mplus &amp;&amp; mplus penalized_invariance.inp"</span><span class="op">)</span></span></code></pre></div>
<pre class="mplus"><code>MODEL RESULTS

                                                    Two-Tailed
                    Estimate       S.E.  Est./S.E.    P-Value

 DEM60    BY
    Y1                 2.097      0.212      9.876      0.000
    Y2                 2.970      0.285     10.439      0.000
    Y3                 2.260      0.323      6.987      0.000
    Y4                 2.970      0.220     13.529      0.000

 DEM65    BY
    Y5                 2.084      0.224      9.315      0.000
    Y6                 2.965      0.289     10.250      0.000
    Y8                 2.986      0.222     13.470      0.000

 DEM65    WITH
    DEM60              0.872      0.056     15.638      0.000

 Y1       WITH
    Y5                 0.941      0.454      2.073      0.038

 Y2       WITH
    Y6                 1.745      0.899      1.940      0.052

 Y4       WITH
    Y8                 0.249      0.504      0.494      0.621

 Means
    DEM60              0.000      0.000    999.000    999.000
    DEM65             -0.153      0.074     -2.071      0.038

 Intercepts
    Y1                 5.461      0.291     18.749      0.000
    Y2                 4.220      0.454      9.288      0.000
    Y3                 6.563      0.376     17.444      0.000
    Y4                 4.472      0.377     11.865      0.000
    Y5                 5.459      0.291     18.786      0.000
    Y6                 3.446      0.455      7.571      0.000
    Y8                 4.480      0.377     11.880      0.000

 Variances
    DEM60              1.000      0.000    999.000    999.000
    DEM65              0.869      0.094      9.207      0.000

 Residual Variances
    Y1                 2.203      0.519      4.243      0.000
    Y2                 6.470      1.338      4.836      0.000
    Y3                 5.513      1.088      5.069      0.000
    Y4                 2.465      0.627      3.930      0.000
    Y5                 3.007      0.617      4.877      0.000
    Y6                 3.741      0.801      4.668      0.000
    Y8                 2.421      0.711      3.406      0.001</code></pre>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hok Chio (Mark) Lai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
