---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# plavaan

<!-- badges: start -->
<!-- badges: end -->

The goal of plavaan is to perform penalized estimation for latent variable models using lavaan with a differentiable penalty function, as described in [Robitzsch (2023)](https://www.mdpi.com/1999-4893/16/9/446) and similar to the approach described in [Asparouhov & Muth√©n (2024)](https://www.statmodel.com/download/PML.pdf).

## Installation

You can install the development version of plavaan like so:

``` r
install.packages("plavaan")
```

## Example

This is a basic example to obtain penalized cross-loadings in a confirmatory factor analysis model:

```{r example}
library(lavaan)
library(plavaan)
data(HolzingerSwineford1939)
model <- '
  visual =~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9
  textual =~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9
  speed =~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9
'

# Dry-run to get starting values for the initial un-identified model
fit_dry <- cfa(model, data = HolzingerSwineford1939, std.lv = TRUE, do.fit = FALSE)

# Locate the cross-loadings to be penalized from the parameter table
pt <- parTable(fit_dry)
subset(pt, op == "=~")

# Fit the penalized model using plavaan::penalized_est()
fit_pen <- penalized_est(
  fit_dry,
  w = 0.01,  # close to a BIC-like weight for penalty
  pen_par_id = c(4:12, 16:24),  # cross-loadings id in the free column
  pen_fn = "l0a"  # approximate L0 penalty
)
summary(fit_pen)
```

Sandwich estimates of standard errors can be obtained using the `se = "robust.huber.white"` argument in `penalized_est()`, but it is unclear how valid these are in the presence of penalization.
