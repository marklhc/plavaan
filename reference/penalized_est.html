<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Penalized Parameter Estimation for Longitudinal CFA Models — penalized_est • plavaan</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Penalized Parameter Estimation for Longitudinal CFA Models — penalized_est"><meta name="description" content="Performs penalized estimation on a lavaan model object by optimizing a
penalized objective function. The function extracts the objective function
from a lavaan model, applies a penalty function to specified parameters
or pairwise differences of parameters, and returns an updated model with
the optimized parameter estimates."><meta property="og:description" content="Performs penalized estimation on a lavaan model object by optimizing a
penalized objective function. The function extracts the objective function
from a lavaan model, applies a penalty function to specified parameters
or pairwise differences of parameters, and returns an updated model with
the optimized parameter estimates."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plavaan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/approximate-invariance.html">Approximate Invariance with Penalized Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/penalized-cat.html">Penalized Estimation with Ordinal Data and Multiple Groups</a></li>
    <li><a class="dropdown-item" href="../articles/penalized-fa.html">Penalized Estimation of Cross-Loadings and Unique Covariances</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Penalized Parameter Estimation for Longitudinal CFA Models</h1>

      <div class="d-none name"><code>penalized_est.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs penalized estimation on a lavaan model object by optimizing a
penalized objective function. The function extracts the objective function
from a lavaan model, applies a penalty function to specified parameters
or pairwise differences of parameters, and returns an updated model with
the optimized parameter estimates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">penalized_est</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">w</span>,</span>
<span>  pen_par_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pen_diff_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pen_fn <span class="op">=</span> <span class="st">"l0a"</span>,</span>
<span>  pen_gr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  se <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  opt_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A fitted lavaan model object from which estimation components will
be extracted.</p></dd>


<dt id="arg-w">w<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>Numeric scalar. Penalty weight (multiplier) applied to the penalty
terms.</p></dd>


<dt id="arg-pen-par-id">pen_par_id<a class="anchor" aria-label="anchor" href="#arg-pen-par-id"></a></dt>
<dd><p>Integer vector of parameter IDs to apply the penalty function
directly to, in the same order as returned by <code>lavaan::coef()</code> and by
<code><a href="https://rdrr.io/pkg/lavaan/man/parTable.html" class="external-link">lavaan::partable()</a></code>, with only the free elements.</p></dd>


<dt id="arg-pen-diff-id">pen_diff_id<a class="anchor" aria-label="anchor" href="#arg-pen-diff-id"></a></dt>
<dd><p>List of matrices containing parameter IDs. For each matrix,
the penalty is applied to the pairwise differences of parameters in the same
column indicated by the IDs. For matrices with names starting with "loading",
the log transformation is applied before computing differences.</p></dd>


<dt id="arg-pen-fn">pen_fn<a class="anchor" aria-label="anchor" href="#arg-pen-fn"></a></dt>
<dd><p>A character string (<code>"l0a"</code> or <code>"alf"</code>) or a function that computes
the penalty. Default is <code>"l0a"</code>.</p></dd>


<dt id="arg-pen-gr">pen_gr<a class="anchor" aria-label="anchor" href="#arg-pen-gr"></a></dt>
<dd><p>A function that computes the gradient of the penalty function.
If <code>pen_fn</code> is <code>"l0a"</code> or <code>"alf"</code>, this is automatically set.</p></dd>


<dt id="arg-se">se<a class="anchor" aria-label="anchor" href="#arg-se"></a></dt>
<dd><p>Character string specifying the type of standard errors to compute.
Options are <code>"none"</code> (default; no standard errors) or <code>"robust.huber.white"</code>
(robust sandwich estimator using numerical Hessian and first-order information,
which is the same as used in the <code>"mlr"</code> estimator).</p></dd>


<dt id="arg-opt-control">opt_control<a class="anchor" aria-label="anchor" href="#arg-opt-control"></a></dt>
<dd><p>A list of control parameters passed to <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code>.
Default includes <code>eval.max = 2e4</code>, <code>iter.max = 1e4</code>, and <code>abs.tol = 1e-20</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A lavaan model object updated with the penalized parameter estimates.
The returned object includes an attribute <code>opt_info</code> containing the
optimization information returned by <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function uses <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb()</a></code> to minimize a penalized objective function that
combines the standard lavaan objective function with a penalty term. Only the
parameter estimates and the log-likelihood should be interpreted. The
returned object was not "fitted" (<code>do.fit = FALSE</code>) to avoid users
interpreting the standard errors, which are generally not valid with
penalized estimation. The degrees of freedom may also be inaccurate. If the
optimization does not converge (convergence code != 0), a warning is issued.</p>
    </div>
    <div class="section level2">
    <h2 id="warning">Warning<a class="anchor" aria-label="anchor" href="#warning"></a></h2>


<p>The returned object is not fitted using standard ML. Standard errors reported
by <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> or <code><a href="https://rdrr.io/pkg/lavaan/man/parameterEstimates.html" class="external-link">parameterEstimates()</a></code> will be missing unless
<code>se = "robust.huber.white"</code> was specified. Even then, they are based on an
experimental sandwich approximation and should be interpreted with caution.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/lavaan/man/lavaan.html" class="external-link">lavaan</a></code>, <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit a longitudinal factor model using PoliticalDemocracy data</span></span></span>
<span class="r-in"><span><span class="va">ind_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y1"</span>, <span class="st">"y2"</span>, <span class="st">"y3"</span>, <span class="st">"y4"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y5"</span>, <span class="st">"y6"</span>, <span class="st">"y7"</span>, <span class="st">"y8"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">longcfa</span><span class="op">(</span><span class="va">ind_mat</span>, lv_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dem60"</span>, <span class="st">"dem65"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">PoliticalDemocracy</span>,</span></span>
<span class="r-in"><span>               long_equal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loadings"</span>, <span class="st">"intercepts"</span><span class="op">)</span>, lag_cov <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Obtain an unidentified model</span></span></span>
<span class="r-in"><span><span class="va">mod_un</span> <span class="op">&lt;-</span> <span class="fu">longcfa_syntax</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">ind_mat</span>, lv_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dem60"</span>, <span class="st">"dem65"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    lag_cov <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    free_latvars <span class="op">=</span> <span class="cn">TRUE</span>, free_latmeans <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_un</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/cfa.html" class="external-link">cfa</a></span><span class="op">(</span><span class="va">mod_un</span>, data <span class="op">=</span> <span class="va">PoliticalDemocracy</span>, do.fit <span class="op">=</span> <span class="cn">FALSE</span>, std.lv <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>              start <span class="op">=</span> <span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get parameter IDs for loadings</span></span></span>
<span class="r-in"><span><span class="va">load_ids</span> <span class="op">&lt;-</span> <span class="fu">get_lav_par_id</span><span class="op">(</span><span class="va">fit_un</span>, op <span class="op">=</span> <span class="st">"=~"</span>, ind_matrix <span class="op">=</span> <span class="va">ind_mat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">int_ids</span> <span class="op">&lt;-</span> <span class="fu">get_lav_par_id</span><span class="op">(</span><span class="va">fit_un</span>, op <span class="op">=</span> <span class="st">"~1"</span>, ind_matrix <span class="op">=</span> <span class="va">ind_mat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Apply penalized estimation with alignment loss</span></span></span>
<span class="r-in"><span><span class="va">pen_fit</span> <span class="op">&lt;-</span> <span class="fu">penalized_est</span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">fit_un</span>,</span></span>
<span class="r-in"><span>    w <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>    pen_diff_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">load_ids</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">int_ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    pen_fn <span class="op">=</span> <span class="st">"alf"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare parameter estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">pen_fit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare log-likelihoods</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scalar invariance"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, <span class="st">"penalized"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">pen_fit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hok Chio (Mark) Lai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

